<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
  <link href="http://localhost:63342/spotifyAPITest/style.css" type="text/css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->
  <style type="text/css">
body {
  font-size: 18px;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: bold;
  padding: 20px;
  color:#B89088;
}
.navigateBar {
  width: 100%;
  height: 60px;
  line-height: 60px;
  display: inline-block;
  background:linear-gradient(to right, #521b37, #2f0c4e );
}

#spotify{
  height: 59px;
}
#logo{
  display: inline-block;
  vertical-align: middle;
  height: 59px;
}
#login{
  height: 60px;
}
a, a:visited{
  color:white;
}
#signup{
  display: inline-block;
  width: 100px;
  padding-left: 30px;
  color: white;
}
#hello{
  padding-left: 30px;
  padding-right: 30px;
  border-right:solid 1px white;
}
#logout{
  padding-left: 30px;
  color: white;
}

.navigateBar span:hover, span a:hover{
  cursor: pointer;
  color: #9BF0E1;
}

#search-form,
.form-control {
  width: 1200px;
  height: 50px;
  margin-bottom: 20px;
  float: left;
  display: block;
}
#query{
  width: 200px;
  height: 50px;
  border-radius: 10px;
  line-height: 50px;
  float: left;
  margin-right: 10px;
  margin-left: 50px;

}
.btn-primary{
  width: 75px;
  height: 40px;
   /* margin-top: 5px; */
  background-size: 50px 50px;
  border-radius: 10%;
  border: hidden;
}
.btn-primary:hover{
  cursor: pointer;
}

.album{
  width: 300px;
  height: 300px;
  display: inline-block;
  background-size: cover;
}
.album img{
  width: 300px;
  height: 300px;
}
  </style>
</head>
<body>
<div id="login">
  <div class="container">
    <h1>Emotify Sprint2 Demo</h1>
    <div class="navigateBar">
      <span id="spotify">
        <a href="https://www.spotify.com/us/"><img id="logo" src="./Spotifylogo.png"></a>
      </span>
      <span id="signup">
        <a href="http://localhost:8888/login">Sign Up</a>
      </span>
      <span id="login">
        <a href="http://localhost:8888/login">Log In</a>
      </span>
    </div>
    <hr>
  </div>
</div>
<div id="loggedin">
  <div class="container">
    <h1>Emotify Sprint2 Demo</h1>
    <div id="userInfo"></div>
    <hr>
  </div>
  <script type="text/x-handlebars-template" id="userInfoTemplate">
    <div class="navigateBar">
      <span id="spotifylogo">
        <a href="https://www.spotify.com/us/"><img id="logo" src="./Spotifylogo.png"></a>
      </span>
      <span id="hello">
        <a href={{external_urls.spotify}} ><!--<img id='headShot' src="{{images.0.url}}">-->Hello {{id}}</a>
      </span>
      <span id="logout">
        Log Out
      </span>
    </div>
  </script>


    <form id="search-form">
      <input type="text" id="query" value="" class="form-control" />
      <input type="submit" id="search" class="btn btn-primary" value="Search" />
    </form>
    <div id="results"></div>

  <div id="videoContainer">
    <video id="video" width="480" height="480" autoplay></video>
  </div>

  <canvas id="canvas" width="48" height="48"></canvas>
  <button id="snap">Snap Photo</button>
  <button id="again">try again</button>
  <button id="upload">Upload</button>

  <script src="snapshot.js" type="text/javascript"></script>

  <script id="results-template" type="text/x-handlebars-template">
    {{#each playlists.items}}
    <div  data-playList-id="{{id}}" class="album">
      <div>
        <a href="{{external_urls.spotify}}"><img src="{{images.0.url}}"></a>
      </div>
    </div>
    {{/each}}
  </script>

<script src="http://localhost:63342/spotifyAPITest/JS/search.js" type="text/javascript"></script>
</div>
<script>
  (function() {

    /**
     * Obtains parameters from the hash of the URL
     * @return Object
     */
    function getHashParams() {
      var hashParams = {};
      var e, r = /([^&;=]+)=?([^&;]*)/g,
          q = window.location.hash.substring(1);
      while ( e = r.exec(q)) {
        hashParams[e[1]] = decodeURIComponent(e[2]);
      }
      return hashParams;
    }

//    var userProfileSource = document.getElementById('user-profile-template').innerHTML,
//        userProfileTemplate = Handlebars.compile(userProfileSource),
//        userProfilePlaceholder = document.getElementById('user-profile');
//
//    var oauthSource = document.getElementById('oauth-template').innerHTML,
//        oauthTemplate = Handlebars.compile(oauthSource),
//        oauthPlaceholder = document.getElementById('oauth');

    var userInfoSource = document.getElementById('userInfoTemplate').innerHTML,
        userInfoTemplate = Handlebars.compile(userInfoSource),
        userInfoPlaceholder = document.getElementById('userInfo');

    var params = getHashParams();

    var access_token = params.access_token,
        refresh_token = params.refresh_token,
        error = params.error;


    if (error) {
      alert('There was an error during the authentication');
    } else {
      if (access_token) {
        // render oauth info
//        oauthPlaceholder.innerHTML = oauthTemplate({
//          access_token: access_token,
//          refresh_token: refresh_token
//        });

        $.ajax({
          url: 'https://api.spotify.com/v1/me',
          headers: {
            'Authorization': 'Bearer ' + access_token
          },
          success: function(response) {
//            userProfilePlaceholder.innerHTML = userProfileTemplate(response);
//            if(response.images == ''){
//              response.images = ima
//            }
            userInfoPlaceholder.innerHTML = userInfoTemplate(response);
            $('#login').hide();
            $('#loggedin').show();

            $('#logout').on('click',function (e) {
              location = "http://www.spotify.com/us/logout";
              window.open("http://localhost:8888");

//              location = "http://localhost:8888";
//              w = window.open("http://www.spotify.com/us/logout");
//              w.onload = function () {
//                w.window.close();
//              close();
//              }
            });
          }
        });
      } else {
        // render initial screen
        $('#login').show();
        $('#loggedin').hide();
      }
    }
  })();
</script>

</body>
</html>

